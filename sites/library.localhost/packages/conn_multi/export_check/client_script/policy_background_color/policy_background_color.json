{
 "creation": "2024-06-12 15:59:58.845200",
 "docstatus": 0,
 "doctype": "Client Script",
 "dt": "Policy",
 "enabled": 1,
 "idx": 0,
 "modified": "2024-06-12 15:59:58.845200",
 "modified_by": "Administrator",
 "module": "Export Check",
 "name": "Policy-Background color",
 "owner": "Administrator",
 "script": "function BackgroundColor(frm) {\n    var fields = frappe.get_meta('Policy').fields;\n    var field_names = fields.map(function(field) {\n        return field.fieldname;\n    });\n\n    field_names.forEach(function(fieldname) {\n        var escapedFieldname = CSS.escape(fieldname);\n        var selector = `[data-fieldname=\"${escapedFieldname}\"]`; \n        var element = document.querySelector(selector);\n        if (element) {\n            var elements = document.querySelectorAll(selector);\n            if (elements.length > 1) {\n                elements[1].style.backgroundColor = '#B3C8CF';\n            }\n        } else {\n            console.error(`Selector not found: ${selector}`);\n        }\n    });\n}\n    \nfrappe.ui.form.on('Policy', {\n    refresh:function(frm){\n        BackgroundColor(frm);\n    },\n    onload: function(frm){\n        BackgroundColor(frm);\n        detectChanges(frm)\n        frm.set_query(\"select_broker\", function() {\n                return {\n                filters: {\n                    custom_is_broker:true\n                }\n            };\n    \n        });\n    },\n    \n    select_broker:function(frm){\n        console.log(frm.doc.select_broker)\n        frappe.call({\n                method: 'frappe.client.get_value',\n                args: {\n                    doctype: 'Customer',\n                    filters: { 'name': frm.doc.select_broker },\n                    fieldname: [ 'custom_commission','customer_name']  // Specify the fields you want to retrieve\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        console.log(\"----commision value setting---\", r.message)\n                        frm.set_value('commission',r.message.custom_commission)\n                        \n                    }\n                }\n            });\n    }\n});\n\nfunction detectChanges(frm) {\n    var fieldList = [\n        'make',\n        'proposer_full_name',\n        'member_of_automation_association',\n        'fibre_glass_tank_fitted',\n        'extension_of_geographical_area',\n        'trailer_attached',\n        'additional_towing_coverage',\n        'has_driving_license',\n        'has_any_other_driver',\n        'want_to_include_pa_cover',\n        'want_to_include_pa_cover_paid_drivers',\n        'want_to_include_pa_cover_unnamed_drivers',\n        'll_to_paid_drivers',\n        'll_to_employees',\n        'll_to_soldiers',\n        'vehicle_proposed_for_insurance',\n        'extra_electrical_device_fittings',\n        'extra_non_electrical_fittings'\n    ];\n\n    var fields = frm.fields_dict;\n    \n    fieldList.forEach(function(fieldname) {\n        var field = fields[fieldname];\n        if (field) {\n            field.df.onchange = function() {\n                BackgroundColor(frm);\n            };\n        }\n    });\n}\n\n// function applyBackgroundStyle() {\n//     var fields = cur_frm.fields_dict;\n//     Object.keys(fields).forEach(function(fieldname) {\n//         var field = fields[fieldname];\n//         var allowedTypes = ['Data', 'Small Text', 'Int', 'Datetime', 'Date', 'Currency','Select','Link', 'Phone','Time'];\n//         if (allowedTypes.includes(field.df.fieldtype)) {\n//             var inputElements = document.querySelectorAll(`[data-fieldname=\"${fieldname}\"] input, [data-fieldname=\"${fieldname}\"] textarea, [data-fieldname=\"${fieldname}\"] select`);\n//             inputElements.forEach(function(inputElement) {\n//                 inputElement.style.backgroundColor = '#B3C8CF';\n\n//             });\n//         }\n//     });\n// }\n\n// frappe.ui.form.on('Vehicle Policy Form', {\n//     onload: function(frm) {\n//         applyBackgroundStyle(); \n//     },\n//     refresh: function(frm){\n//         applyBackgroundStyle(); \n//     }\n// });\n\n",
 "view": "Form"
}