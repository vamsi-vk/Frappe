{
 "creation": "2024-06-07 12:47:19.186572",
 "docstatus": 0,
 "doctype": "Client Script",
 "dt": "Demo",
 "enabled": 1,
 "idx": 0,
 "modified": "2024-06-12 18:14:47.223021",
 "modified_by": "Administrator",
 "module": "Export Check",
 "name": "Edit",
 "owner": "Administrator",
 "script": "frappe.ui.form.on('Demo', {\n after_save: function(frm) {\n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Version',\n                filters: {\n                    ref_doctype: frm.doc.doctype,\n                    docname: frm.doc.name\n                },\n                fields: ['name', 'data', 'modified'],\n                order_by: 'modified desc'\n            },\n            callback: function(response) {\n                if(response.message && response.message.length > 0) {\n                    let firstVersion = response.message[0];\n                    let versionData = JSON.parse(firstVersion.data);\n                    var check = false\n                    console.log(\"chekc\",check)\n                    versionData.changed.forEach(change => {\n                        var fieldValue = frm.doc.endorcement;\n                        if (change.includes(fieldValue)) {\n                                check = true;\n                            }\n                    });\n                    if (check == true){\n                        var data = firstVersion.name;\n                        var field = frm.doc.endorcement\n                        vamsi(frm,data,field);\n                    }\n                } else {\n                    console.log('No version data found.');\n                }\n            }\n        });\n    },\n    \nrefresh: function(frm) {\n           frm.$wrapper.find('.actions').hide();\n        set_fields_editable_except_endorcement(frm, false);\n        frm.add_custom_button(__('Edit'), function() {\n            set_fields_editable_except_endorcement(frm, true);\n            show_id_dialog(frm);\n        });\n    }\n});\n\nfunction set_fields_editable_except_endorcement(frm, editable) {\n    $.each(frm.fields_dict, function(fieldname, field) {\n        if (fieldname !== 'endorcement') {\n            frm.set_df_property(fieldname, 'read_only', !editable);\n        }\n    });\n    frm.refresh_fields();\n}\n\nfunction show_id_dialog(frm) {\n    frappe.prompt([\n        {\n            'fieldname': 'id',\n            'fieldtype': 'Data',\n            'label': __('Enter your ID'),\n            'reqd': 1\n        }\n    ],\n    function(values){\n        frm.set_value('endorcement', values.id);\n    },\n    __('Enter ID'),\n    __('Submit')\n    );\n}\nfunction vamsi(frm,data,fieldValue){\n        frappe.call({\n            method: 'frappe.client.insert',\n            args: {\n                doc: {\n                    doctype: 'Comment',\n                    comment_type: 'Comment',\n                    reference_doctype: 'Demo',\n                    reference_name: frm.doc.name,\ncontent: `\n <p style=\"padding-bottom:5px\">Updated the Document</p>\n    <table border=\"0\" cellspacing=\"0\" style=\"width: 100%; border-collapse: collapse; border-radius: 10px;\">\n        <tr>\n            <td style=\"background-color: #1A2130;padding: 10px;margin-left:20px; border-radius:10px; color:white; width: 33%;\">ID: ${fieldValue}</td>\n            <td style=\"background-color: #83B4FF; padding:10px; border-radius:10px;color:black; width: 33%;\">Type: Extra Endorsement</td>\n            <td style=\"background-color: rgb(222,239,226); color: rgb(65,12,85); padding: 10px; border-radius: 10px; width: 34%;\"><a href=\"http://crm.erp.connetin.in/app/version/${data}\" style=\"text-decoration: none; color: rgb(65,12,85);\">To Check changes click here</a></td>\n     </tr>\n    </table><br>\n    `}\n            },\n            callback: function(response) {\n                if (response.exc) {\n                    frappe.msgprint(__('Failed to add comment.'));\n                }\n            }\n        });\n        location.reload();\n}\n        console.error('Error fetching endorsement details.');\n\n \n",
 "view": "Form"
}